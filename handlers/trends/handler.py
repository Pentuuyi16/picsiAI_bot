from aiogram import Router, F
from aiogram.types import CallbackQuery
from database.database import Database
from keyboards.inline import get_trends_keyboard

router = Router()


@router.callback_query(F.data == "trends")
async def trends_handler(callback: CallbackQuery):
    user_id = callback.from_user.id
    db = Database()
    generations = db.get_user_generations(user_id)
    
    try:
        await callback.message.delete()
    except:
        pass
    
    generation_text = f"<blockquote>‚ö° –£ –≤–∞—Å –æ—Å—Ç–∞–ª–æ—Å—å: {generations} –≥–µ–Ω–µ—Ä–∞—Ü–∏–π"
    if generations == 1:
        generation_text += "\nüé® –í–∞–º –¥–æ—Å—Ç—É–ø–Ω–∞ 1 –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è"
    generation_text += "</blockquote>"
    
    await callback.message.answer(
        f"–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–µ–Ω–¥, –∫–æ—Ç–æ—Ä—ã–π –ª—É—á—à–µ –≤—Å–µ–≥–æ –≤–∞–º –ø–æ–¥—Ö–æ–¥–∏—Ç üí´\n\n"
        f"{generation_text}",
        parse_mode="HTML",
        reply_markup=get_trends_keyboard(page=1)
    )
    await callback.answer()


# –ï—Å–ª–∏ –µ—Å—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—è —Ç—Ä–µ–Ω–¥–æ–≤, –¥–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –≤—Ç–æ—Ä–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
@router.callback_query(F.data == "trends_page_2")
async def trends_page_2_handler(callback: CallbackQuery):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Ç–æ—Ä–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç—Ä–µ–Ω–¥–æ–≤"""
    user_id = callback.from_user.id
    
    # –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
    db = Database()
    generations = db.get_user_generations(user_id)
    
    # –ó–¥–µ—Å—å –¥–æ–±–∞–≤—å—Ç–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–ª—è –≤—Ç–æ—Ä–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç—Ä–µ–Ω–¥–æ–≤ (–µ—Å–ª–∏ –µ—Å—Ç—å)
    # –ü–æ–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
    await callback.message.edit_text(
        f"–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–µ–Ω–¥, –∫–æ—Ç–æ—Ä—ã–π –ª—É—á—à–µ –≤—Å–µ–≥–æ –≤–∞–º –ø–æ–¥—Ö–æ–¥–∏—Ç üí´\n\n"
        f"<blockquote>‚ö° –£ –≤–∞—Å –æ—Å—Ç–∞–ª–æ—Å—å: {generations} –≥–µ–Ω–µ—Ä–∞—Ü–∏–π</blockquote>",
        parse_mode="HTML",
        reply_markup=get_trends_keyboard(page=1)
    )
    await callback.answer()